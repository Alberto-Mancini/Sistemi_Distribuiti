<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Casale Mancini</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-custom">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin Panel</a>
            <button class="btn btn-outline-light" id="logout-btn">Logout</button>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Tabs di navigazione -->
        <ul class="nav nav-tabs" id="adminTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="bookings-tab" data-bs-toggle="tab" data-bs-target="#bookings" type="button" role="tab">Prenotazioni</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rooms-tab" data-bs-toggle="tab" data-bs-target="#rooms" type="button" role="tab">Gestione Stanze</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="menus-tab" data-bs-toggle="tab" data-bs-target="#menus" type="button" role="tab">Gestione Menu</button>
            </li>
        </ul>

        <!-- Contenuto dei Tabs -->
        <div class="tab-content" id="adminTabContent">
            <!-- Sezione Prenotazioni -->
            <div class="tab-pane fade show active" id="bookings" role="tabpanel">
                <div class="card card-body border-top-0">
                    <h3 class="mb-3">Tutte le Prenotazioni</h3>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome Cliente</th>
                                    <th>Email</th>
                                    <th>Telefono</th>
                                    <th>Data Sogg.</th>
                                    <th>Ospiti</th>
                                    <th>Ristor.</th>
                                    <th>Stanza</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sezione Gestione Stanze -->
            <div class="tab-pane fade" id="rooms" role="tabpanel">
                <div class="card card-body border-top-0">
                    <h3 class="mb-3">Aggiungi Nuova Stanza</h3>
                    <form id="add-room-form">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="roomName" class="form-label">Nome Stanza</label>
                                <input type="text" class="form-control" id="roomName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="roomCapacity" class="form-label">Capacità (N° Ospiti)</label>
                                <input type="number" class="form-control" id="roomCapacity" min="1" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="roomDescription" class="form-label">Descrizione</label>
                            <textarea class="form-control" id="roomDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Aggiungi Stanza</button>
                    </form>
                </div>
            </div>

            <!-- Sezione Gestione Menu -->
            <div class="tab-pane fade" id="menus" role="tabpanel">
                <div class="card card-body border-top-0">
                    <h3 class="mb-3">Aggiorna Menu</h3>
                    <form id="update-menu-form">
                        <div class="mb-3">
                            <label for="menuTitle" class="form-label">Titolo Menu (es. Menu del Giorno)</label>
                            <input type="text" class="form-control" id="menuTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="menuContent" class="form-label">Contenuto del Menu</label>
                            <textarea class="form-control" id="menuContent" rows="10"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Salva Menu</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- LOGICA GENERALE ---
        document.getElementById('logout-btn').addEventListener('click', () => {
            fetch('/api/logout', { method: 'POST' }).then(() => window.location.href = '/login.html');
        });

        // --- LOGICA PRENOTAZIONI ---
        function fetchBookings() {
            fetch('/api/admin/bookings')
                .then(res => res.ok ? res.json() : Promise.reject('Errore caricamento'))
                .then(data => {
                    const tbody = document.getElementById('bookings-table-body');
                    tbody.innerHTML = '';
                    data.forEach(b => {
                        const row = `<tr>
                            <td>${b.id}</td>
                            <td>${b.name}</td>
                            <td>${b.email}</td>
                            <td>${b.phone}</td>
                            <td>${new Date(b.booking_date).toLocaleDateString()}</td>
                            <td>${b.guests}</td>
                            <td>${b.dining ? 'Sì' : 'No'}</td>
                            <td>${b.room_name}</td>
                        </tr>`;
                        tbody.innerHTML += row;
                    });
                }).catch(err => console.error(err));
        }

        // --- LOGICA GESTIONE STANZE ---
        document.getElementById('add-room-form').addEventListener('submit', e => {
            e.preventDefault();
            const roomData = {
                name: document.getElementById('roomName').value,
                capacity: parseInt(document.getElementById('roomCapacity').value),
                description: document.getElementById('roomDescription').value
            };
            fetch('/api/admin/rooms', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(roomData)
            }).then(res => {
                if (res.ok) {
                    alert('Stanza aggiunta con successo!');
                    e.target.reset();
                } else {
                    res.json().then(err => alert('Errore: ' + err.message));
                }
            });
        });

        // --- LOGICA GESTIONE MENU ---
        function fetchMenu() {
            fetch('/api/admin/menu')
                .then(res => res.ok ? res.json() : Promise.reject('Errore caricamento menu'))
                .then(menu => {
                    document.getElementById('menuTitle').value = menu.title;
                    document.getElementById('menuContent').value = menu.content;
                }).catch(err => console.error(err));
        }

        document.getElementById('update-menu-form').addEventListener('submit', e => {
            e.preventDefault();
            const menuData = {
                title: document.getElementById('menuTitle').value,
                content: document.getElementById('menuContent').value
            };
            fetch('/api/admin/menu', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(menuData)
            }).then(res => {
                if (res.ok) {
                    alert('Menu aggiornato con successo!');
                } else {
                    res.json().then(err => alert('Errore: ' + err.message));
                }
            });
        });

        // Carica i dati iniziali quando la pagina è pronta
        document.addEventListener('DOMContentLoaded', () => {
            fetchBookings();
            fetchMenu();
        });
    </script>
        <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 text-center text-md-start mb-3 mb-md-0">
                    <h5>Casale Mancini</h5>
                    <p>&copy; 2025. Tutti i diritti riservati.</p>
                </div>
                <div class="col-md-4 text-center mb-3 mb-md-0">
                    <h5>Contatti</h5>
                    <p><a href="mailto:casamancini@temporaneo.com">casamancini@temporaneo.com</a><br>Tel: 0881204858</p>
                </div>
                <div class="col-md-4 text-center text-md-end">
                    <h5>Orari</h5>
                    <p>Aperti tutti i giorni<br>dalle 8:00 alle 20:00</p>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>